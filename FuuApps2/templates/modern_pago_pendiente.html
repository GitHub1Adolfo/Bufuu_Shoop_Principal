{% load static %}
{% load humanize %}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/modern_base.css' %}">
    <link rel="stylesheet" href="{% static 'css/modern_receipt.css' %}">
    <title>Orden Recibida</title>
</head>

<body>
    <div class="receipt-page" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
        <div class="receipt-container">
            <!-- Header -->
            <div class="receipt-header" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                <div class="receipt-icon" style="font-size: 5rem;">üìã</div>
                <h1 class="receipt-store-name">¬°Orden Recibida!</h1>
                <p class="receipt-title">Pago en Efectivo - Pendiente de Revisi√≥n</p>
            </div>

            <!-- Body -->
            <div class="receipt-body">
                <!-- Orden Number -->
                <div class="order-number">
                    <div class="order-label">N√∫mero de Orden</div>
                    <div class="order-id">#{{ orden.orden_id }}</div>
                </div>

                <!-- Info Box -->
                <div style="background: white; padding: 2rem; border-radius: 1rem; margin: 2rem 0; text-align: center;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">üíµ</div>
                    <h3 style="margin-bottom: 1rem; color: black;">Pago en Efectivo</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        Tu pedido ser√° revisado y empacado. Pagar√°s al recibir tu orden.
                    </p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: left; max-width: 400px; margin: 0 auto; margin-right: 18%;">
                        <div>
                            <strong style="color: black;">Total a Pagar:</strong><br>
                            <span style="font-size: 1.5rem; color: var(--primary-color);">${{ orden.total|floatformat:0|intcomma }}</span>
                        </div>
                        <div>
                            <strong style="color: black;">Estado:</strong><br>
                            <span style="color: #f59e0b; font-weight: 700;">En Revisi√≥n</span>
                        </div>
                    </div>
                </div>

                <!-- SECCI√ìN DE QR CODES -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 2rem 0;">
                    
                    <!-- QR CLIENTE -->
                    <div style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); padding: 2rem; border-radius: 1rem; text-align: center;">
                        <h4 style="margin-bottom: 1rem; color: #1e40af; font-size: 1.25rem; font-weight: 700;">üì± Tu C√≥digo QR</h4>
                        <p style="color: #1e3a8a; margin-bottom: 1.5rem; font-size: 0.875rem;">
                            Para ver el estado de tu orden
                        </p>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: 0.75rem; display: inline-block; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                            <img src="{{ qr_cliente }}" alt="QR Cliente" style="width: 200px !important; height: 200px !important; display: block; max-width: none !important;">
                        </div>
                        
                        <div style="margin-top: 1rem; padding: 0.75rem; border-radius: 0.5rem; background: rgba(255, 255, 255, 0.5);">
                            <p style="margin: 0; font-size: 0.875rem; color: #1e3a8a;">
                                üíæ Guarda este c√≥digo
                            </p>
                        </div>

                        <!-- Bot√≥n para ver estado sin escanear -->
                        <a href="{% url 'ver_qr_orden' orden.orden_id %}" style="display: inline-block; margin-top: 1rem; padding: 0.875rem 2rem; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white; border-radius: 0.75rem; text-decoration: none; font-weight: 700; box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4); transition: all 0.3s;">
                            üëÅÔ∏è Ver Estado de mi Orden
                        </a>
                    </div>

                    <!-- QR ADMIN/STAFF -->
                    <div style="background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%); padding: 2rem; border-radius: 1rem; text-align: center;">
                        <h4 style="margin-bottom: 1rem; color: #7c3aed; font-size: 1.25rem; font-weight: 700;">üîß C√≥digo para Staff</h4>
                        <p style="color: #6b21a8; margin-bottom: 1.5rem; font-size: 0.875rem;">
                            Para que revisen tu pedido
                        </p>
                        
                        <div style="background: white; padding: 1.5rem; border-radius: 0.75rem; display: inline-block; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                            <img src="{{ qr_admin }}" alt="QR Admin" style="width: 200px !important; height: 200px !important; display: block; max-width: none !important;">
                        </div>
                        
                        <div style="margin-top: 1rem; padding: 0.75rem; border-radius: 0.5rem; background: rgba(255, 255, 255, 0.5);">
                            <p style="margin: 0; font-size: 0.875rem; color: #6b21a8;">
                                üñ®Ô∏è Muestra este c√≥digo al repartidor
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Instrucciones -->
                <div style="padding: 1.5rem; background: #fffbeb; border-radius: 0.75rem; border-left: 4px solid #f59e0b; margin-top: 2rem;">
                    <strong style="color: #92400e;">üìå ¬øC√≥mo funciona?</strong>
                    <ol style="margin: 1rem 0 0; padding-left: 1.5rem; color: #92400e;">
                        <li style="margin-bottom: 0.5rem;"><strong>Muestra el QR de Staff</strong> cuando vengan a entregar tu pedido</li>
                        <li style="margin-bottom: 0.5rem;">El repartidor <strong>escanear√° el QR</strong> para revisar y empacar tu orden</li>
                        <li style="margin-bottom: 0.5rem;">Podr√° <strong>ajustar productos</strong> si algo no est√° disponible</li>
                        <li style="margin-bottom: 0.5rem;">Te mostrar√° el <strong>total final</strong> antes de pagar</li>
                        <li><strong>Pagas en efectivo</strong> al recibir tu pedido</li>
                    </ol>
                </div>

                <!-- Timeline de Estado -->
                <div style="background: white; padding: 2rem; border-radius: 1rem; margin: 2rem 0;">
                    <h3 style="text-align: center; margin-bottom: 1.5rem; color: #6b21a8;">üìã Estado de tu Pedido</h3>
                    
                    <div class="timeline">
                        <div class="timeline-item active">
                            <div class="timeline-icon">‚úÖ</div>
                            <div class="timeline-content">
                                <strong>Pedido Recibido</strong>
                                <p>{{ orden.fecha|date:"d/m/Y H:i" }}</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item active">
                            <div class="timeline-icon">‚è≥</div>
                            <div class="timeline-content">
                                <strong>En Revisi√≥n</strong>
                                <p>Esperando escaneo del staff</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-icon">üì¶</div>
                            <div class="timeline-content">
                                <strong>Empacando</strong>
                                <p>Staff preparando tu orden</p>
                            </div>
                        </div>
                        
                        <div class="timeline-item">
                            <div class="timeline-icon">üöö</div>
                            <div class="timeline-content">
                                <strong>En Camino</strong>
                                <p>Tu pedido est√° siendo entregado</p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-icon">üíµ</div>
                            <div class="timeline-content">
                                <strong>Pago en Efectivo</strong>
                                <p>Pagar√°s al recibir</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="receipt-footer">
                <h3 class="receipt-message">¬°Gracias por tu compra!</h3>
                <p class="receipt-submessage">Prepararemos tu pedido con cuidado</p>
                
                <div class="receipt-actions">
                    <a href="{% url 'ver_qr_orden' orden.orden_id %}" class="btn-primary-receipt">
                        üëÅÔ∏è Ver Estado de mi Orden
                    </a>

                    <a href="{% url 'mis_ordenes' %}" class="btn-secondary-receipt">
                        üì¶ Mis √ìrdenes
                    </a>
                    
                    <a href="{% url 'menu' %}" class="btn-secondary-receipt">
                        üõçÔ∏è Seguir Comprando
                    </a>
                    
                    <button onclick="window.print()" class="btn-secondary-receipt">
                        üñ®Ô∏è Imprimir QR Codes
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
        /* Estilos para QR - IMPORTANTE */
        .receipt-body img[alt*="QR"],
        img[alt="QR Cliente"],
        img[alt="QR Admin"] {
            width: 250px !important;
            height: 250px !important;
            max-width: 250px !important;
            min-width: 250px !important;
            display: block !important;
        }

        /* Timeline */
        .timeline {
            position: relative;
            padding-left: 3rem;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 1rem;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #e5e7eb;
        }

        .timeline-item {
            position: relative;
            padding-bottom: 2rem;
            opacity: 0.4;
        }

        .timeline-item.active {
            opacity: 1;
        }

        .timeline-icon {
            position: absolute;
            left: -2.5rem;
            width: 2.5rem;
            height: 2.5rem;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .timeline-item.active .timeline-icon {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border-color: #f59e0b;
        }

        .timeline-content strong {
            display: block;
            margin-bottom: 0.25rem;
            color: black;
        }

        .timeline-content p {
            margin: 0;
            color: black;
            font-size: 0.875rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            div[style*="grid-template-columns: 1fr 1fr"] {
                grid-template-columns: 1fr !important;
            }

            img[alt="QR Cliente"],
            img[alt="QR Admin"] {
                width: 180px !important;
                height: 180px !important;
            }
        }

        @media print {
            .receipt-actions {
                display: none;
            }
            a[style*="Ver Estado"] {
                display: none !important;
            }
        }
    </style>
</body>
</html>